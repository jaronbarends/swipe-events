(function(g){g.fn.touchEvents=function(i){if(!this)return false;var d={swipeThreshold:75,mouseEmulation:false,triggerOnTouchEnd:true,endOnFingerCountChange:true,allowPageScroll:"auto"},m="left",r="right",s="up",t="down",J="none",D="horizontal",E="vertical",K="auto",L="startMove",M="move",N="swipe",u="end",v="cancel",w=false,x=true,c={};i&&g.extend(d,i);return this.each(function(){function i(a){x&&(w=x=false,c={touches:[]},n(L));var b=a.touches;c.touches=[];for(var j=0,d=b.length;j<d;j++)c.touches.push({start:{x:b[j].pageX, y:b[j].pageY}});y(a);z(a)}function F(a){if(c.phase==u||c.phase==v){var a=c.phase,b=g("#log"),j=b.html();b.html(a+"<br>"+j)}else{y(a);if(d.allowPageScroll==J)a.preventDefault();else switch(b=d.allowPageScroll==K,c.touches[0].direction){case m:(d.swipeLeft&&b||!b&&d.allowPageScroll!=D)&&a.preventDefault();break;case r:(d.swipeRight&&b||!b&&d.allowPageScroll!=D)&&a.preventDefault();break;case s:(d.swipeUp&&b||!b&&d.allowPageScroll!=E)&&a.preventDefault();break;case t:(d.swipeDown&&b||!b&&d.allowPageScroll!= E)&&a.preventDefault()}!d.triggerOnTouchEnd&&G()?(n(N),w?p("swipeMove"):H(a)):n(M);z(a)}}function A(a){var b,j,o,e;a.preventDefault();if(a.touches.length){for(var g=c.touches,k=a.touches,h=[],l,h=[],f=0,i=k.length;f<i;f++){l=1E5;o=k[f].pageX;e=k[f].pageY;for(var q=0,m=g.length;q<m;q++)b=g[q].end.x-o,j=g[q].end.y-e,b=Math.sqrt(Math.pow(b,2)+Math.pow(j,2)),b<l&&(h[f]=q,l=b)}o=[];for(f=0;f<h.length;f++)o[f]=c.touches[h[f]];c.touches=o;y();p("touchCountChange")}if(!a.touches.length||a.touches.length&& d.endOnTouchCountChange)n(u),G()?d.triggerOnTouchEnd&&H(a):n(v),z(a)}function O(){}function p(a){a+=".touchEvent";B.trigger(a,c)}function H(){w=true;p("swipe");var a=c.touches[0].direction,b=[];b[m]="swipeLeft";b[r]="swipeRight";b[s]="swipeUp";b[t]="swipeDown";p(b[a])}function z(){c.phase!=c.prevPhase&&p("swipeStatus")}function C(a,b){var c=[];a!==A&&c.push({pageX:b.pageX,pageY:b.pageY});b.touches=c;a.call(this,b)}function I(a){C(F,a)}function P(a){g(this).bind("mousemove",I);C(i,a)}function Q(a){g(this).unbind("mousemove", I);C(A,a)}function G(){var a=c.touches[0].distance,b=Math.abs(a.x),a=Math.abs(a.y);return Math.max(b,a)>=d.swipeThreshold}function y(a){for(var b=a.touches,d=0,g=b.length;d<g;d++){var e=c.touches[d];e.end={x:b[d].pageX,y:b[d].pageY};e.distance={x:e.end.x-e.start.x,y:e.end.y-e.start.y};var i=e,k,h=e.start,l=e.end;k=l.x-h.x;h=l.y-h.y;k=Math.abs(k)>=Math.abs(h)?k>0?r:m:h>0?t:s;i.direction=k;c.touches[d]=e}for(var f in c.touches[0])c[f]=c.touches[0][f];b=b.length;c.prevTouchCount=c.touchCount||b;c.touchCount= b;c.originalEvent=a}function n(a){c.prevPhase=c.phase;c.phase=a;if(a===v||a===u)x=true}var B=g(this);if("ontouchstart"in window)try{this.addEventListener("touchstart",i,false),this.addEventListener("touchmove",F,false),this.addEventListener("touchend",A,false),this.addEventListener("touchcancel",O,false)}catch(R){}else B.bind("mousedown",P),B.bind("mouseup",Q)})}})(jQuery);
